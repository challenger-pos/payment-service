# Homologation Profile Configuration
spring:
  config:
    activate:
      on-profile: homologation

  datasource:
    url: ${SPRING_DATASOURCE_URL}
    username: ${SPRING_DATASOURCE_USERNAME}
    password: ${SPRING_DATASOURCE_PASSWORD}
    driver-class-name: org.postgresql.Driver

  jpa:
    hibernate:
      ddl-auto: validate # Let Flyway manage schema; Hibernate validates against migrations
    show-sql: true
    properties:
      hibernate:
        dialect: org.hibernate.dialect.PostgreSQLDialect
        format_sql: true
  cloud:
    aws:
      region:
        static: us-east-2
      credentials:
        access-key: ${AWS_ACCESS_KEY}
        secret-key: ${AWS_SECRET_KEY}
      stack:
        auto: false
      sqs:
        listener:
          # Use ON_SUCCESS acknowledgment mode for idempotency
          acknowledgement-mode: on-success
          # 5 minutes visibility timeout (enough for Mercado Pago API calls + processing)
          visibility-timeout: 300

  # AWS Configuration (dummy values for local development)
  aws:
    region: us-east-2
    credentials:
      access-key: ${AWS_ACCESS_KEY}
      secret-key: ${AWS_SECRET_KEY}
    sqs:
      payment-request-queue: payment-request-queue
      payment-request-dlq: payment-request-dlq # Dead Letter Queue for failed messages
      payment-response-success-queue: payment-response-success-queue
      payment-response-failure-queue: payment-response-failure-queue
      auto-create-queue: true # Automatically create queue if it doesn't exist
      max-receive-count: 3 # Move to DLQ after 3 failed attempts

  # Mercado Pago Configuration (dummy values for local development)
  mercadopago:
    access-token: TEST-2418882740517708-021123-3284a32c834a784ab7abe89af125def1-306429912
    public-key: TEST-c5f78030-b1af-4a2d-8ff6-0a3752bfd11e

# Actuator Configuration for Homologation
management:
  endpoint:
    health:
      show-details: always
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus

  logging:
    level:
      com.fiap.billing_service: INFO
      com.icegreen.greenmail: WARN
      org.springframework.mail: WARN
